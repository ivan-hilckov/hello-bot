# Development Docker image for Hello Bot with hot reloading
FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
  && rm -rf /var/lib/apt/lists/*

# Create non-root user for security
RUN groupadd -r botuser && useradd -r -g botuser botuser

WORKDIR /app

# Install Python dependencies (including development tools)
RUN pip install aiogram python-dotenv pydantic pydantic-settings \
  sqlalchemy[asyncio] asyncpg alembic watchfiles \
  fastapi uvicorn[standard] prometheus-client slowapi \
  redis hiredis structlog

# Create app directory and set permissions
RUN chown -R botuser:botuser /app

# Switch to non-root user
USER botuser

# The application code will be mounted as volume in development
# No need to COPY code since it will be live-mounted

# Run the development script with file watching
CMD ["python", "scripts/dev_run.py"]