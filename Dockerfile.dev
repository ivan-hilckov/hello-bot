# Simple development Docker image for Hello Bot
FROM python:3.12-alpine

# Install system dependencies
RUN apk add --no-cache gcc musl-dev

# Create non-root user for security
RUN addgroup -g 1001 -S botuser && \
  adduser -u 1001 -S botuser -G botuser

WORKDIR /app

# Install simple Python dependencies
RUN pip install --no-cache-dir \
  aiogram \
  sqlalchemy[asyncio] \
  asyncpg \
  pydantic-settings \
  fastapi \
  uvicorn \
  watchdog

# Create app directory and set permissions
RUN chown -R botuser:botuser /app

# Switch to non-root user
USER botuser

# The application code will be mounted as volume in development
# No need to COPY code since it will be live-mounted

# Run bot with hot reload using watchdog
CMD ["watchmedo", "auto-restart", "--patterns=*.py", "--recursive", "--", "python", "-m", "app.main"]
